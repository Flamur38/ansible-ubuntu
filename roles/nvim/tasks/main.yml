---
# ==================================================
# Neovim setup (Lazy.nvim based)
# ==================================================

# --------------------------------------------------
# Install Neovim dependencies
# --------------------------------------------------
- name: Install Neovim dependencies
  become: true
  ansible.builtin.apt:
    name:
      - neovim
      - ripgrep
      - fd-find
      - gcc
      - g++
      - make
      - unzip
      - curl
      - git
      - cmake
      - ninja-build
      - gettext
      - build-essential
      - lua5.1
      - liblua5.1-0-dev
      - python3
      - python3-pip
      - nodejs
      - npm
      - cargo
    state: present
    update_cache: true

# --------------------------------------------------
# Ensure ~/.config exists
# --------------------------------------------------
- name: Ensure user config directory exists
  ansible.builtin.file:
    path: "/home/{{ ansible_env.SUDO_USER }}/.config"
    state: directory
    owner: "{{ ansible_env.SUDO_USER }}"
    group: "{{ ansible_env.SUDO_USER }}"
    mode: "0755"

# --------------------------------------------------
# Deploy Neovim configuration
# --------------------------------------------------
- name: Deploy Neovim configuration
  ansible.builtin.copy:
    src: nvim
    dest: "/home/{{ ansible_env.SUDO_USER }}/.config/"
    owner: "{{ ansible_env.SUDO_USER }}"
    group: "{{ ansible_env.SUDO_USER }}"
    mode: "0755"

# --------------------------------------------------
# Bootstrap Lazy.nvim plugins (run once)
# --------------------------------------------------
- name: Install Neovim plugins (Lazy.nvim)
  ansible.builtin.command:
    cmd: nvim --headless "+Lazy! sync" +qa
  args:
    creates: "/home/{{ ansible_env.SUDO_USER }}/.local/share/nvim/lazy"
  changed_when: false
